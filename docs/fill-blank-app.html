<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanskbert - Fyll i luckan</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; }
        .back-btn {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 10px 16px; background: rgba(255,255,255,0.1);
            border: none; border-radius: 10px; color: #888;
            font-size: 0.95rem; cursor: pointer; transition: all 0.2s;
            text-decoration: none; margin-bottom: 20px;
        }
        .back-btn:hover { background: rgba(255,255,255,0.15); color: #fff; }
        header { text-align: center; padding: 20px 0 30px; }
        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #e74c3c, #f39c12);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; margin-bottom: 8px;
        }
        header p { color: #888; font-size: 1rem; }
        .stats-overview { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 25px; }
        .stat-card { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 18px 12px; text-align: center; }
        .stat-value { font-size: 1.8rem; font-weight: bold; }
        .stat-value.sessions { color: #e74c3c; }
        .stat-value.correct { color: #2ecc71; }
        .stat-value.streak { color: #f39c12; }
        .stat-label { font-size: 0.8rem; color: #888; margin-top: 5px; }
        .main-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 30px; }
        .main-btn {
            padding: 18px 20px; border: none; border-radius: 15px;
            font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s;
        }
        .main-btn.primary { background: linear-gradient(90deg, #e74c3c, #f39c12); color: #fff; }
        .main-btn.secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .main-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .section-title { font-size: 0.85rem; color: #666; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; }
        .categories-list { display: flex; flex-direction: column; gap: 10px; }
        .category-group { margin-bottom: 15px; }
        .category-group-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 14px 18px; background: rgba(255,255,255,0.08);
            border-radius: 12px; cursor: pointer; transition: all 0.2s; margin-bottom: 8px;
        }
        .category-group-header:hover { background: rgba(255,255,255,0.12); }
        .category-group-title { display: flex; align-items: center; gap: 10px; font-size: 1rem; font-weight: 600; color: #fff; }
        .category-group-title .group-icon { font-size: 1.2rem; }
        .category-group-count { color: #888; font-size: 0.85rem; }
        .category-group-arrow { color: #666; font-size: 1.2rem; transition: transform 0.3s; }
        .category-group.expanded .category-group-arrow { transform: rotate(180deg); }
        .category-group-items { display: none; flex-direction: column; gap: 8px; padding-left: 12px; }
        .category-group.expanded .category-group-items { display: flex; }
        .category-item {
            display: flex; align-items: center; padding: 16px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08);
            border-radius: 15px; cursor: pointer; transition: all 0.2s;
        }
        .category-item:hover { background: rgba(255,255,255,0.08); transform: translateX(5px); }
        .category-icon {
            width: 50px; height: 50px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; margin-right: 15px; flex-shrink: 0;
        }
        .category-info { flex: 1; }
        .category-name { font-size: 1.1rem; font-weight: 600; margin-bottom: 4px; }
        .category-count { font-size: 0.9rem; color: #888; }
        .progress-circle { width: 45px; height: 45px; }
        .progress-circle svg { transform: rotate(-90deg); }
        .progress-circle .bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 4; }
        .progress-circle .progress { fill: none; stroke: #2ecc71; stroke-width: 4; stroke-linecap: round; }
        .exercise-view { display: none; }
        .exercise-view.active { display: block; }
        .category-view { display: block; }
        .category-view.hidden { display: none; }
        .exercise-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; }
        .exercise-title { font-size: 1.3rem; font-weight: 600; }
        .exercise-progress-text { color: #888; font-size: 0.95rem; }
        .stats-bar { display: flex; justify-content: center; gap: 25px; margin-bottom: 25px; }
        .stat { text-align: center; padding: 12px 20px; background: rgba(255,255,255,0.05); border-radius: 12px; }
        .stat .stat-value { font-size: 1.5rem; }
        .stat.correct .stat-value { color: #2ecc71; }
        .stat.wrong .stat-value { color: #e74c3c; }
        .stat.streak .stat-value { color: #f39c12; }
        .progress-container { margin-bottom: 25px; }
        .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #e74c3c, #f39c12); border-radius: 3px; transition: width 0.3s; }
        .question-card {
            background: rgba(255,255,255,0.05); border-radius: 20px;
            padding: 30px; margin-bottom: 20px; text-align: center;
        }
        .question-label { font-size: 0.85rem; color: #888; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 2px; }
        .question-sentence { font-size: 1.5rem; font-weight: bold; margin-bottom: 15px; line-height: 1.6; }
        .question-sentence .blank { color: #e74c3c; border-bottom: 3px solid #e74c3c; padding: 0 20px; }
        .question-translation { font-size: 1rem; color: #888; font-style: italic; }
        .input-area { margin-bottom: 20px; }
        .answer-input {
            width: 100%; padding: 16px; font-size: 1.2rem;
            border: 2px solid rgba(255,255,255,0.2); border-radius: 12px;
            background: rgba(255,255,255,0.05); color: #fff;
            text-align: center; outline: none; transition: all 0.3s;
        }
        .answer-input:focus { border-color: #e74c3c; }
        .answer-input.correct { border-color: #2ecc71; background: rgba(46, 204, 113, 0.2); }
        .answer-input.wrong { border-color: #e74c3c; background: rgba(231, 76, 60, 0.2); }
        .check-btn, .next-btn {
            width: 100%; padding: 16px; border: none; border-radius: 12px;
            background: linear-gradient(90deg, #e74c3c, #f39c12);
            color: #fff; font-size: 1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s;
        }
        .check-btn:hover, .next-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .next-btn { display: none; }
        .next-btn.show { display: block; }
        .feedback { text-align: center; padding: 12px; border-radius: 10px; margin-bottom: 15px; display: none; }
        .feedback.show { display: block; }
        .feedback.correct { background: rgba(46, 204, 113, 0.2); color: #2ecc71; }
        .feedback.wrong { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
        .keyboard-hints { text-align: center; color: #555; font-size: 0.8rem; margin-top: 15px; }
        .keyboard-hints kbd { background: rgba(255,255,255,0.1); padding: 3px 8px; border-radius: 4px; margin: 0 2px; }
        .results { text-align: center; padding: 40px 20px; background: rgba(255,255,255,0.05); border-radius: 20px; display: none; }
        .results.show { display: block; }
        .results h2 { font-size: 1.8rem; margin-bottom: 20px; }
        .results-stats { display: flex; justify-content: center; gap: 30px; margin: 25px 0; }
        .results-stat { text-align: center; }
        .results-stat-value { font-size: 2.5rem; font-weight: bold; }
        .results-stat-label { color: #888; font-size: 0.9rem; }
        .restart-btn {
            padding: 16px 40px; border: none; border-radius: 15px;
            font-size: 1rem; cursor: pointer;
            background: linear-gradient(90deg, #e74c3c, #f39c12);
            color: #fff; font-weight: 600; margin-top: 15px; transition: all 0.3s;
        }
        .restart-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        @media (max-width: 500px) {
            .container { padding: 15px; }
            header h1 { font-size: 2rem; }
            .question-sentence { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="category-view" id="categoryView">
            <a href="index.html" class="back-btn"><span>‚Üê</span> Huvudmeny</a>
            <header>
                <h1>Fyll i luckan</h1>
                <p>Komplettera meningar med r√§tt ord</p>
            </header>
            <div class="stats-overview">
                <div class="stat-card"><div class="stat-value sessions" id="totalSessions">0</div><div class="stat-label">√ñvningar</div></div>
                <div class="stat-card"><div class="stat-value correct" id="totalCorrect">0</div><div class="stat-label">R√§tt</div></div>
                <div class="stat-card"><div class="stat-value streak" id="accuracy">0%</div><div class="stat-label">Tr√§ffs√§kerhet</div></div>
            </div>
            <div class="main-buttons">
                <button class="main-btn primary" id="practiceAllBtn">√ñva alla</button>
                <button class="main-btn secondary" id="randomBtn">Slumpa</button>
            </div>
            <div class="section-title">Kategorier</div>
            <div class="categories-list" id="categoriesList"></div>
        </div>

        <div class="exercise-view" id="exerciseView">
            <button class="back-btn" id="backToCategories"><span>‚Üê</span> Tillbaka</button>
            <div class="exercise-header">
                <div class="exercise-title" id="exerciseTitle">Kategori</div>
                <div class="exercise-progress-text" id="exerciseProgressText">1/10</div>
            </div>
            <div class="stats-bar">
                <div class="stat correct"><div class="stat-value" id="correctCount">0</div><div class="stat-label">R√§tt</div></div>
                <div class="stat wrong"><div class="stat-value" id="wrongCount">0</div><div class="stat-label">Fel</div></div>
                <div class="stat streak"><div class="stat-value" id="currentStreak">0</div><div class="stat-label">Streak</div></div>
            </div>
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
            </div>
            <div class="question-card">
                <div class="question-label">Fyll i r√§tt ord</div>
                <div class="question-sentence" id="questionSentence">Mening med <span class="blank">___</span></div>
                <div class="question-translation" id="questionTranslation">Svensk √∂vers√§ttning</div>
            </div>
            <div class="input-area">
                <input type="text" class="answer-input" id="answerInput" placeholder="Skriv svaret..." autocomplete="off">
            </div>
            <div class="feedback" id="feedback"></div>
            <button class="check-btn" id="checkBtn">Kolla svar</button>
            <button class="next-btn" id="nextBtn">N√§sta ‚Üí</button>
            <div class="keyboard-hints"><kbd>Enter</kbd> Kolla/N√§sta</div>
            <div class="results" id="resultsScreen">
                <h2>Bra jobbat!</h2>
                <div class="results-stats">
                    <div class="results-stat"><div class="results-stat-value" id="finalCorrect" style="color: #2ecc71;">0</div><div class="results-stat-label">R√§tt</div></div>
                    <div class="results-stat"><div class="results-stat-value" id="finalWrong" style="color: #e74c3c;">0</div><div class="results-stat-label">Fel</div></div>
                    <div class="results-stat"><div class="results-stat-value" id="finalPercent" style="color: #f39c12;">0%</div><div class="results-stat-label">Resultat</div></div>
                </div>
                <button class="restart-btn" id="restartBtn">K√∂r igen!</button>
                <br><button class="back-btn" id="backFromResults" style="margin-top: 15px;">‚Üê V√§lj annan kategori</button>
            </div>
        </div>
    </div>

    <script>
        const exerciseData = {
            "saludos": {
                "name": "H√§lsningar", "icon": "üëã", "color": "#f39c12",
                "items": [
                    {"sentence": "¬°___ d√≠as!", "answer": "Buenos", "translation": "God morgon!"},
                    {"sentence": "¬°___ noches!", "answer": "Buenas", "translation": "God kv√§ll!"},
                    {"sentence": "¬ø___ tal?", "answer": "Qu√©", "translation": "Hur √§r det?"},
                    {"sentence": "¬øC√≥mo ___?", "answer": "est√°s", "translation": "Hur m√•r du?"},
                    {"sentence": "Mucho ___", "answer": "gusto", "translation": "Trevligt att tr√§ffas"},
                    {"sentence": "Hasta ___", "answer": "luego", "translation": "Vi ses!"},
                    {"sentence": "Bien, ___", "answer": "gracias", "translation": "Bra, tack"},
                    {"sentence": "Muy ___", "answer": "bien", "translation": "Mycket bra"}
                ]
            },
            "presentacion": {
                "name": "Presentera dig", "icon": "üó£Ô∏è", "color": "#e67e22",
                "items": [
                    {"sentence": "Me ___ Johan", "answer": "llamo", "translation": "Jag heter Johan"},
                    {"sentence": "Soy ___ Suecia", "answer": "de", "translation": "Jag √§r fr√•n Sverige"},
                    {"sentence": "___ 30 a√±os", "answer": "Tengo", "translation": "Jag √§r 30 √•r"},
                    {"sentence": "___ en Palma", "answer": "Vivo", "translation": "Jag bor i Palma"},
                    {"sentence": "¬øDe ___ eres?", "answer": "d√≥nde", "translation": "Var kommer du ifr√•n?"},
                    {"sentence": "¬ø___ te llamas?", "answer": "C√≥mo", "translation": "Vad heter du?"},
                    {"sentence": "Soy ___", "answer": "sueco", "translation": "Jag √§r svensk"}
                ]
            },
            "familia": {
                "name": "Familjen", "icon": "üë®‚Äçüë©‚Äçüëß", "color": "#9b59b6",
                "items": [
                    {"sentence": "Mi ___ se llama Pedro", "answer": "padre", "translation": "Min pappa heter Pedro"},
                    {"sentence": "Mi ___ es Mar√≠a", "answer": "madre", "translation": "Min mamma √§r Mar√≠a"},
                    {"sentence": "Tengo un ___", "answer": "hermano", "translation": "Jag har en bror"},
                    {"sentence": "Tengo una ___", "answer": "hermana", "translation": "Jag har en syster"},
                    {"sentence": "Mi ___ tiene 5 a√±os", "answer": "hijo", "translation": "Min son √§r 5 √•r"},
                    {"sentence": "Mi ___ es alta", "answer": "hija", "translation": "Min dotter √§r l√•ng"}
                ]
            },
            "verbos": {
                "name": "Verb", "icon": "üìù", "color": "#8e44ad",
                "items": [
                    {"sentence": "___ sueco", "answer": "Soy", "translation": "Jag √§r svensk (permanent)"},
                    {"sentence": "___ cansado", "answer": "Estoy", "translation": "Jag √§r tr√∂tt (tillf√§lligt)"},
                    {"sentence": "___ dos hijos", "answer": "Tengo", "translation": "Jag har tv√• barn"},
                    {"sentence": "___ espa√±ol", "answer": "Hablo", "translation": "Jag pratar spanska"},
                    {"sentence": "___ en Barcelona", "answer": "Trabajo", "translation": "Jag jobbar i Barcelona"},
                    {"sentence": "Me ___ la m√∫sica", "answer": "gusta", "translation": "Jag gillar musik"}
                ]
            },
            "colores": {
                "name": "F√§rger", "icon": "üé®", "color": "#2ecc71",
                "items": [
                    {"sentence": "El cielo es ___", "answer": "azul", "translation": "Himlen √§r bl√•"},
                    {"sentence": "La hierba es ___", "answer": "verde", "translation": "Gr√§set √§r gr√∂nt"},
                    {"sentence": "El sol es ___", "answer": "amarillo", "translation": "Solen √§r gul"},
                    {"sentence": "La sangre es ___", "answer": "roja", "translation": "Blodet √§r r√∂tt"},
                    {"sentence": "La nieve es ___", "answer": "blanca", "translation": "Sn√∂n √§r vit"},
                    {"sentence": "El carb√≥n es ___", "answer": "negro", "translation": "Kolet √§r svart"}
                ]
            },
            "en_el_medico": {
                "name": "Hos l√§karen", "icon": "üè•", "color": "#e74c3c",
                "items": [
                    {"sentence": "Me duele la ___", "answer": "cabeza", "translation": "Jag har huvudv√§rk"},
                    {"sentence": "Tengo ___", "answer": "fiebre", "translation": "Jag har feber"},
                    {"sentence": "Necesito una ___", "answer": "receta", "translation": "Jag beh√∂ver ett recept"},
                    {"sentence": "Me duele la ___", "answer": "garganta", "translation": "Jag har ont i halsen"},
                    {"sentence": "Tomo ___", "answer": "medicamentos", "translation": "Jag tar mediciner"},
                    {"sentence": "Tengo ___", "answer": "alergia", "translation": "Jag har allergi"}
                ]
            },
            "deportes": {
                "name": "Sport", "icon": "‚öΩ", "color": "#2ecc71",
                "items": [
                    {"sentence": "Me gusta el ___", "answer": "f√∫tbol", "translation": "Jag gillar fotboll"},
                    {"sentence": "Vamos al ___", "answer": "gimnasio", "translation": "Vi g√•r till gymmet"},
                    {"sentence": "Quiero ___ la carrera", "answer": "ganar", "translation": "Jag vill vinna loppet"},
                    {"sentence": "Me gusta ___", "answer": "correr", "translation": "Jag gillar att springa"},
                    {"sentence": "Hay un ___ hoy", "answer": "partido", "translation": "Det √§r en match idag"}
                ]
            },
            "el_tiempo": {
                "name": "V√§der", "icon": "üå§Ô∏è", "color": "#f39c12",
                "items": [
                    {"sentence": "Hace ___", "answer": "sol", "translation": "Det √§r soligt"},
                    {"sentence": "Hace ___", "answer": "fr√≠o", "translation": "Det √§r kallt"},
                    {"sentence": "Hace ___", "answer": "calor", "translation": "Det √§r varmt"},
                    {"sentence": "___ mucho", "answer": "Llueve", "translation": "Det regnar mycket"},
                    {"sentence": "Hace buen ___", "answer": "tiempo", "translation": "Det √§r fint v√§der"},
                    {"sentence": "Hace ___", "answer": "viento", "translation": "Det bl√•ser"}
                ]
            },
            "comida_y_bebida": {
                "name": "Mat & dryck", "icon": "üçï", "color": "#e67e22",
                "items": [
                    {"sentence": "Quiero ___, por favor", "answer": "agua", "translation": "Jag vill ha vatten, tack"},
                    {"sentence": "Me gusta el ___", "answer": "pollo", "translation": "Jag gillar kyckling"},
                    {"sentence": "Un ___ con leche", "answer": "caf√©", "translation": "En kaffe med mj√∂lk"},
                    {"sentence": "Quiero ___ y huevos", "answer": "pan", "translation": "Jag vill ha br√∂d och √§gg"},
                    {"sentence": "Una ___, por favor", "answer": "cerveza", "translation": "En √∂l, tack"},
                    {"sentence": "Me gusta el ___", "answer": "queso", "translation": "Jag gillar ost"}
                ]
            },
            "en_la_escuela": {
                "name": "I skolan", "icon": "üéì", "color": "#3498db",
                "items": [
                    {"sentence": "El ___ es dif√≠cil", "answer": "examen", "translation": "Provet √§r sv√•rt"},
                    {"sentence": "Necesito un ___", "answer": "libro", "translation": "Jag beh√∂ver en bok"},
                    {"sentence": "Tengo una ___", "answer": "pregunta", "translation": "Jag har en fr√•ga"},
                    {"sentence": "Hago los ___", "answer": "deberes", "translation": "Jag g√∂r l√§xorna"},
                    {"sentence": "La ___ empieza a las nueve", "answer": "clase", "translation": "Lektionen b√∂rjar klockan nio"}
                ]
            },
            "cuerpo": {
                "name": "Kroppen", "icon": "ü¶¥", "color": "#1abc9c",
                "items": [
                    {"sentence": "Me duele la ___", "answer": "cabeza", "translation": "Jag har ont i huvudet"},
                    {"sentence": "Me duele el ___", "answer": "est√≥mago", "translation": "Jag har ont i magen"},
                    {"sentence": "Me duele la ___", "answer": "espalda", "translation": "Jag har ont i ryggen"},
                    {"sentence": "Me duele el ___", "answer": "brazo", "translation": "Jag har ont i armen"},
                    {"sentence": "Me duele la ___", "answer": "pierna", "translation": "Jag har ont i benet"},
                    {"sentence": "Me duele el ___", "answer": "pie", "translation": "Jag har ont i foten"}
                ]
            },
            "ropa": {
                "name": "Kl√§der", "icon": "üëï", "color": "#e91e63",
                "items": [
                    {"sentence": "Necesito una ___", "answer": "camiseta", "translation": "Jag beh√∂ver en t-shirt"},
                    {"sentence": "Me gustan los ___", "answer": "zapatos", "translation": "Jag gillar skorna"},
                    {"sentence": "Llevo una ___", "answer": "chaqueta", "translation": "Jag har p√• mig en jacka"},
                    {"sentence": "Necesito unos ___", "answer": "pantalones", "translation": "Jag beh√∂ver byxor"},
                    {"sentence": "Me gusta el ___", "answer": "vestido", "translation": "Jag gillar kl√§nningen"}
                ]
            },
            "profesiones": {
                "name": "Yrken", "icon": "üë©‚Äçüíº", "color": "#673ab7",
                "items": [
                    {"sentence": "Soy ___", "answer": "m√©dico", "translation": "Jag √§r l√§kare"},
                    {"sentence": "Quiero ser ___", "answer": "profesor", "translation": "Jag vill bli l√§rare"},
                    {"sentence": "Mi padre es ___", "answer": "ingeniero", "translation": "Min pappa √§r ingenj√∂r"},
                    {"sentence": "El ___ apaga el fuego", "answer": "bombero", "translation": "Brandmannen sl√§cker elden"},
                    {"sentence": "El ___ cocina bien", "answer": "cocinero", "translation": "Kocken lagar mat bra"}
                ]
            },
            "animales": {
                "name": "Djur", "icon": "üêæ", "color": "#795548",
                "items": [
                    {"sentence": "Tengo un ___", "answer": "perro", "translation": "Jag har en hund"},
                    {"sentence": "Mi ___ es negro", "answer": "gato", "translation": "Min katt √§r svart"},
                    {"sentence": "El ___ es grande", "answer": "caballo", "translation": "H√§sten √§r stor"},
                    {"sentence": "Me gustan los ___", "answer": "p√°jaros", "translation": "Jag gillar f√•glar"},
                    {"sentence": "El ___ es fuerte", "answer": "le√≥n", "translation": "Lejonet √§r starkt"},
                    {"sentence": "El ___ es muy grande", "answer": "elefante", "translation": "Elefanten √§r j√§ttestor"}
                ]
            }
        };

        let questions = [];
        let currentIndex = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let streak = 0;
        let currentCategory = null;
        let hasAnswered = false;

        const categoryView = document.getElementById('categoryView');
        const exerciseView = document.getElementById('exerciseView');
        const categoriesList = document.getElementById('categoriesList');
        const answerInput = document.getElementById('answerInput');
        const feedback = document.getElementById('feedback');
        const checkBtn = document.getElementById('checkBtn');
        const nextBtn = document.getElementById('nextBtn');
        const resultsScreen = document.getElementById('resultsScreen');

        const categoryGroups = {
            "situationer": {
                name: "Situationer",
                icon: "üéØ",
                categories: ["en_el_medico", "deportes", "el_tiempo", "comida_y_bebida", "en_la_escuela"]
            },
            "grundlaggande": {
                name: "Grundl√§ggande",
                icon: "üìö",
                categories: ["saludos", "presentacion", "familia", "verbos", "colores", "cuerpo", "ropa", "profesiones", "animales"]
            }
        };

        function createCategoryItem(key, categoryProgress) {
            const cat = exerciseData[key];
            const progress = categoryProgress[key] || 0;
            const circumference = 2 * Math.PI * 18;
            const offset = circumference - (progress / 100) * circumference;
            const item = document.createElement('div');
            item.className = 'category-item';
            item.innerHTML = `
                <div class="category-icon" style="background: ${cat.color}20; color: ${cat.color};">${cat.icon}</div>
                <div class="category-info"><div class="category-name">${cat.name}</div><div class="category-count">${cat.items.length} √∂vningar</div></div>
                <div class="progress-circle"><svg width="45" height="45"><circle class="bg" cx="22.5" cy="22.5" r="18"></circle><circle class="progress" cx="22.5" cy="22.5" r="18" stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" style="stroke: ${cat.color}"></circle></svg></div>
            `;
            item.addEventListener('click', () => startExercise(key));
            return item;
        }

        function initCategories() {
            const saved = JSON.parse(localStorage.getItem('spanishFillBlank') || '{}');
            const categoryProgress = saved.categoryProgress || {};
            const expandedGroups = JSON.parse(localStorage.getItem('spanishFillBlankExpanded') || '[]');

            Object.keys(categoryGroups).forEach(groupKey => {
                const group = categoryGroups[groupKey];
                const totalItems = group.categories.reduce((sum, catKey) => sum + (exerciseData[catKey]?.items.length || 0), 0);

                const groupEl = document.createElement('div');
                groupEl.className = 'category-group' + (expandedGroups.includes(groupKey) ? ' expanded' : '');
                groupEl.dataset.group = groupKey;

                const header = document.createElement('div');
                header.className = 'category-group-header';
                header.innerHTML = `
                    <div class="category-group-title"><span class="group-icon">${group.icon}</span>${group.name}</div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span class="category-group-count">${group.categories.length} kategorier ¬∑ ${totalItems} √∂vningar</span>
                        <span class="category-group-arrow">‚ñº</span>
                    </div>
                `;
                header.addEventListener('click', () => toggleGroup(groupKey));

                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'category-group-items';

                group.categories.forEach(catKey => {
                    if (exerciseData[catKey]) {
                        itemsContainer.appendChild(createCategoryItem(catKey, categoryProgress));
                    }
                });

                groupEl.appendChild(header);
                groupEl.appendChild(itemsContainer);
                categoriesList.appendChild(groupEl);
            });

            updateOverviewStats();
        }

        function toggleGroup(groupKey) {
            const groupEl = document.querySelector(`.category-group[data-group="${groupKey}"]`);
            groupEl.classList.toggle('expanded');
            const expandedGroups = [];
            document.querySelectorAll('.category-group.expanded').forEach(g => expandedGroups.push(g.dataset.group));
            localStorage.setItem('spanishFillBlankExpanded', JSON.stringify(expandedGroups));
        }

        function updateOverviewStats() {
            const saved = JSON.parse(localStorage.getItem('spanishFillBlank') || '{}');
            document.getElementById('totalSessions').textContent = saved.sessions || 0;
            document.getElementById('totalCorrect').textContent = saved.totalCorrect || 0;
            const total = (saved.totalCorrect || 0) + (saved.totalWrong || 0);
            const acc = total > 0 ? Math.round((saved.totalCorrect / total) * 100) : 0;
            document.getElementById('accuracy').textContent = `${acc}%`;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startExercise(category) {
            currentCategory = category;
            let items = category === 'all'
                ? Object.values(exerciseData).flatMap(c => c.items)
                : exerciseData[category].items;
            questions = shuffle([...items]);
            currentIndex = 0; correctCount = 0; wrongCount = 0; streak = 0;
            const title = category === 'all' ? 'Alla kategorier' : exerciseData[category].name;
            document.getElementById('exerciseTitle').textContent = title;
            categoryView.classList.add('hidden');
            exerciseView.classList.add('active');
            resultsScreen.classList.remove('show');
            displayQuestion();
        }

        function displayQuestion() {
            if (currentIndex >= questions.length) { showResults(); return; }
            hasAnswered = false;
            const q = questions[currentIndex];
            document.getElementById('questionSentence').innerHTML = q.sentence.replace('___', '<span class="blank">___</span>');
            document.getElementById('questionTranslation').textContent = q.translation;
            answerInput.value = '';
            answerInput.className = 'answer-input';
            answerInput.disabled = false;
            answerInput.focus();
            feedback.classList.remove('show', 'correct', 'wrong');
            checkBtn.style.display = 'block';
            nextBtn.classList.remove('show');
            updateProgress();
        }

        function checkAnswer() {
            if (hasAnswered) return;
            const userAnswer = answerInput.value.trim().toLowerCase();
            const correct = questions[currentIndex].answer.toLowerCase();
            hasAnswered = true;
            answerInput.disabled = true;
            if (userAnswer === correct) {
                correctCount++; streak++;
                answerInput.classList.add('correct');
                feedback.textContent = 'R√§tt!';
                feedback.className = 'feedback show correct';
            } else {
                wrongCount++; streak = 0;
                answerInput.classList.add('wrong');
                feedback.textContent = `Fel! R√§tt svar: ${questions[currentIndex].answer}`;
                feedback.className = 'feedback show wrong';
            }
            checkBtn.style.display = 'none';
            nextBtn.classList.add('show');
            updateStats();
        }

        function nextQuestion() { currentIndex++; displayQuestion(); }

        function updateProgress() {
            const progress = (currentIndex / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('exerciseProgressText').textContent = `${currentIndex + 1}/${questions.length}`;
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            document.getElementById('currentStreak').textContent = streak;
        }

        function showResults() {
            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalWrong').textContent = wrongCount;
            const total = correctCount + wrongCount;
            const percent = total > 0 ? Math.round((correctCount / total) * 100) : 0;
            document.getElementById('finalPercent').textContent = `${percent}%`;
            resultsScreen.classList.add('show');
            saveProgress(percent);
        }

        function saveProgress(percent) {
            const saved = JSON.parse(localStorage.getItem('spanishFillBlank') || '{}');
            saved.totalCorrect = (saved.totalCorrect || 0) + correctCount;
            saved.totalWrong = (saved.totalWrong || 0) + wrongCount;
            saved.sessions = (saved.sessions || 0) + 1;
            if (currentCategory && currentCategory !== 'all') {
                saved.categoryProgress = saved.categoryProgress || {};
                saved.categoryProgress[currentCategory] = Math.max(saved.categoryProgress[currentCategory] || 0, percent);
            }
            localStorage.setItem('spanishFillBlank', JSON.stringify(saved));
        }

        function backToCategories() {
            exerciseView.classList.remove('active');
            categoryView.classList.remove('hidden');
            resultsScreen.classList.remove('show');
            updateOverviewStats();
            categoriesList.innerHTML = '';
            initCategories();
        }

        document.getElementById('practiceAllBtn').addEventListener('click', () => startExercise('all'));
        document.getElementById('randomBtn').addEventListener('click', () => startExercise('all'));
        document.getElementById('backToCategories').addEventListener('click', backToCategories);
        document.getElementById('backFromResults').addEventListener('click', backToCategories);
        document.getElementById('restartBtn').addEventListener('click', () => { resultsScreen.classList.remove('show'); startExercise(currentCategory); });
        checkBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', nextQuestion);
        answerInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') { hasAnswered ? nextQuestion() : checkAnswer(); }
        });
        initCategories();
    </script>
</body>
</html>
