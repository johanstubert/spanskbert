<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanskbert - Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 10px;
            color: #888;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.15);
            color: #fff;
        }

        header {
            text-align: center;
            padding: 20px 0 30px;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #9b59b6, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        header p {
            color: #888;
            font-size: 1rem;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 18px 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .stat-value.streak { color: #f39c12; }
        .stat-value.correct { color: #2ecc71; }
        .stat-value.sessions { color: #9b59b6; }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        .main-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 30px;
        }

        .main-btn {
            padding: 18px 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .main-btn.primary {
            background: linear-gradient(90deg, #9b59b6, #3498db);
            color: #fff;
        }

        .main-btn.secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .main-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .section-title {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }

        .categories-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Category Groups */
        .category-group {
            margin-bottom: 15px;
        }

        .category-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
        }

        .category-group-header:hover {
            background: rgba(255,255,255,0.12);
        }

        .category-group-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
        }

        .category-group-title .group-icon {
            font-size: 1.2rem;
        }

        .category-group-count {
            color: #888;
            font-size: 0.85rem;
        }

        .category-group-arrow {
            color: #666;
            font-size: 1.2rem;
            transition: transform 0.3s;
        }

        .category-group.expanded .category-group-arrow {
            transform: rotate(180deg);
        }

        .category-group-items {
            display: none;
            flex-direction: column;
            gap: 8px;
            padding-left: 12px;
        }

        .category-group.expanded .category-group-items {
            display: flex;
        }

        .category-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-item:hover {
            background: rgba(255,255,255,0.08);
            transform: translateX(5px);
        }

        .category-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .category-info {
            flex: 1;
        }

        .category-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .category-count {
            font-size: 0.9rem;
            color: #888;
        }

        .progress-circle {
            width: 45px;
            height: 45px;
        }

        .progress-circle svg {
            transform: rotate(-90deg);
        }

        .progress-circle .bg {
            fill: none;
            stroke: rgba(255,255,255,0.1);
            stroke-width: 4;
        }

        .progress-circle .progress {
            fill: none;
            stroke: #2ecc71;
            stroke-width: 4;
            stroke-linecap: round;
        }

        .quiz-view {
            display: none;
        }

        .quiz-view.active {
            display: block;
        }

        .category-view {
            display: block;
        }

        .category-view.hidden {
            display: none;
        }

        .quiz-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .quiz-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .quiz-progress-text {
            color: #888;
            font-size: 0.95rem;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 25px;
        }

        .stat {
            text-align: center;
            padding: 12px 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }

        .stat .stat-value {
            font-size: 1.5rem;
        }

        .stat.correct .stat-value { color: #2ecc71; }
        .stat.wrong .stat-value { color: #e74c3c; }
        .stat.score .stat-value { color: #f39c12; }

        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 25px;
        }

        .mode-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .mode-btn.active {
            background: linear-gradient(90deg, #9b59b6, #3498db);
            color: #fff;
        }

        .progress-container {
            margin-bottom: 25px;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9b59b6, #3498db);
            border-radius: 3px;
            transition: width 0.3s;
        }

        .question-card {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
        }

        .question-label {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .question-word {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .question-category {
            font-size: 0.8rem;
            color: #666;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .option-btn {
            padding: 16px 12px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-btn:hover:not(:disabled) {
            border-color: rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.08);
        }

        .option-btn.correct {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.3);
        }

        .option-btn.wrong {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.3);
        }

        .option-btn:disabled {
            cursor: default;
        }

        .feedback {
            text-align: center;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .feedback.wrong {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .next-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, #9b59b6, #3498db);
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: none;
        }

        .next-btn.show {
            display: block;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .keyboard-hints {
            text-align: center;
            color: #555;
            font-size: 0.8rem;
            margin-top: 15px;
        }

        .keyboard-hints kbd {
            background: rgba(255,255,255,0.1);
            padding: 3px 8px;
            border-radius: 4px;
            margin: 0 2px;
        }

        .results {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            display: none;
        }

        .results.show {
            display: block;
        }

        .results h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        .results-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
        }

        .results-stat {
            text-align: center;
        }

        .results-stat-value {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .results-stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        .restart-btn {
            padding: 16px 40px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            background: linear-gradient(90deg, #9b59b6, #3498db);
            color: #fff;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        @media (max-width: 500px) {
            .container {
                padding: 15px;
            }

            header h1 {
                font-size: 2rem;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .question-word {
                font-size: 1.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Category View -->
        <div class="category-view" id="categoryView">
            <a href="index.html" class="back-btn">
                <span>‚Üê</span> Huvudmeny
            </a>

            <header>
                <h1>Quiz</h1>
                <p>V√§lj r√§tt √∂vers√§ttning bland 4 alternativ</p>
            </header>

            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-value sessions" id="totalSessions">0</div>
                    <div class="stat-label">Quizar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value correct" id="totalCorrect">0</div>
                    <div class="stat-label">R√§tta svar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value streak" id="accuracy">0%</div>
                    <div class="stat-label">Tr√§ffs√§kerhet</div>
                </div>
            </div>

            <div class="main-buttons">
                <button class="main-btn primary" id="practiceAllBtn">√ñva alla</button>
                <button class="main-btn secondary" id="quickQuizBtn">Snabbquiz</button>
            </div>

            <div class="section-title">Kategorier</div>

            <div class="categories-list" id="categoriesList">
            </div>
        </div>

        <!-- Quiz View -->
        <div class="quiz-view" id="quizView">
            <button class="back-btn" id="backToCategories">
                <span>‚Üê</span> Tillbaka
            </button>

            <div class="quiz-header">
                <div class="quiz-title" id="quizTitle">Kategori</div>
                <div class="quiz-progress-text" id="quizProgressText">1/15</div>
            </div>

            <div class="stats-bar">
                <div class="stat correct">
                    <div class="stat-value" id="correctCount">0</div>
                    <div class="stat-label">R√§tt</div>
                </div>
                <div class="stat wrong">
                    <div class="stat-value" id="wrongCount">0</div>
                    <div class="stat-label">Fel</div>
                </div>
                <div class="stat score">
                    <div class="stat-value" id="scorePercent">0%</div>
                    <div class="stat-label">Score</div>
                </div>
            </div>

            <div class="mode-toggle">
                <button class="mode-btn active" data-mode="es_to_sv">üá™üá∏ ‚Üí üá∏üá™</button>
                <button class="mode-btn" data-mode="sv_to_es">üá∏üá™ ‚Üí üá™üá∏</button>
                <button class="mode-btn" data-mode="mixed">Blandat</button>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="question-card">
                <div class="question-label" id="questionLabel">√ñvers√§tt till svenska</div>
                <div class="question-word" id="questionWord">Palabra</div>
                <div class="question-category" id="questionCategory">Kategori</div>
            </div>

            <div class="options-grid" id="optionsGrid">
                <button class="option-btn" data-index="0">Alternativ 1</button>
                <button class="option-btn" data-index="1">Alternativ 2</button>
                <button class="option-btn" data-index="2">Alternativ 3</button>
                <button class="option-btn" data-index="3">Alternativ 4</button>
            </div>

            <div class="feedback" id="feedback"></div>

            <button class="next-btn" id="nextBtn">N√§sta fr√•ga ‚Üí</button>

            <div class="keyboard-hints">
                <kbd>1</kbd><kbd>2</kbd><kbd>3</kbd><kbd>4</kbd> V√§lj ¬∑ <kbd>Enter</kbd> N√§sta
            </div>

            <!-- Results Screen -->
            <div class="results" id="resultsScreen">
                <h2>Bra jobbat!</h2>
                <div class="results-stats">
                    <div class="results-stat">
                        <div class="results-stat-value" id="finalCorrect" style="color: #2ecc71;">0</div>
                        <div class="results-stat-label">R√§tt</div>
                    </div>
                    <div class="results-stat">
                        <div class="results-stat-value" id="finalWrong" style="color: #e74c3c;">0</div>
                        <div class="results-stat-label">Fel</div>
                    </div>
                    <div class="results-stat">
                        <div class="results-stat-value" id="finalPercent" style="color: #f39c12;">0%</div>
                        <div class="results-stat-label">Resultat</div>
                    </div>
                </div>
                <button class="restart-btn" id="restartBtn">K√∂r igen!</button>
                <br>
                <button class="back-btn" id="backFromResults" style="margin-top: 15px;">‚Üê V√§lj annan kategori</button>
            </div>
        </div>
    </div>

    <script>
        const flashcardData = {
            "saludos": {
                "name": "H√§lsningar",
                "icon": "üëã",
                "color": "#f39c12",
                "items": [
                    {"es": "¬°Hola!", "sv": "Hej!"},
                    {"es": "¬øQu√© tal?", "sv": "Hur √§r det?"},
                    {"es": "¬øC√≥mo est√°s?", "sv": "Hur m√•r du?"},
                    {"es": "¬°Buenos d√≠as!", "sv": "God morgon!"},
                    {"es": "¬°Buenas tardes!", "sv": "God eftermiddag!"},
                    {"es": "¬°Buenas noches!", "sv": "God kv√§ll!"},
                    {"es": "Adi√≥s", "sv": "Hejd√•"},
                    {"es": "¬°Hasta luego!", "sv": "Vi ses!"},
                    {"es": "¬°Hasta ma√±ana!", "sv": "Vi ses imorgon!"},
                    {"es": "Mucho gusto", "sv": "Trevligt att tr√§ffas"},
                    {"es": "Bien, gracias", "sv": "Bra, tack"},
                    {"es": "Muy bien", "sv": "Mycket bra"}
                ]
            },
            "numeros": {
                "name": "Siffror",
                "icon": "#",
                "color": "#3498db",
                "items": [
                    {"es": "cero", "sv": "0"}, {"es": "uno", "sv": "1"}, {"es": "dos", "sv": "2"},
                    {"es": "tres", "sv": "3"}, {"es": "cuatro", "sv": "4"}, {"es": "cinco", "sv": "5"},
                    {"es": "seis", "sv": "6"}, {"es": "siete", "sv": "7"}, {"es": "ocho", "sv": "8"},
                    {"es": "nueve", "sv": "9"}, {"es": "diez", "sv": "10"}, {"es": "once", "sv": "11"},
                    {"es": "doce", "sv": "12"}, {"es": "trece", "sv": "13"}, {"es": "catorce", "sv": "14"},
                    {"es": "quince", "sv": "15"}, {"es": "veinte", "sv": "20"}, {"es": "treinta", "sv": "30"},
                    {"es": "cuarenta", "sv": "40"}, {"es": "cincuenta", "sv": "50"}, {"es": "cien", "sv": "100"},
                    {"es": "mil", "sv": "1000"}
                ]
            },
            "interrogativos": {
                "name": "Fr√•geord",
                "icon": "?",
                "color": "#e74c3c",
                "items": [
                    {"es": "¬øQu√©?", "sv": "Vad?"},
                    {"es": "¬øQui√©n?", "sv": "Vem?"},
                    {"es": "¬øC√≥mo?", "sv": "Hur?"},
                    {"es": "¬øCu√°ndo?", "sv": "N√§r?"},
                    {"es": "¬øD√≥nde?", "sv": "Var?"},
                    {"es": "¬øDe d√≥nde?", "sv": "Varifr√•n?"},
                    {"es": "¬øCu√°nto?", "sv": "Hur mycket?"},
                    {"es": "¬øCu√°ntos?", "sv": "Hur m√•nga?"},
                    {"es": "¬øPor qu√©?", "sv": "Varf√∂r?"},
                    {"es": "¬øCu√°l?", "sv": "Vilken?"}
                ]
            },
            "familia": {
                "name": "Familjen",
                "icon": "üë®‚Äçüë©‚Äçüëß",
                "color": "#9b59b6",
                "items": [
                    {"es": "el padre", "sv": "pappan"},
                    {"es": "la madre", "sv": "mamman"},
                    {"es": "los padres", "sv": "f√∂r√§ldrarna"},
                    {"es": "el hijo", "sv": "sonen"},
                    {"es": "la hija", "sv": "dottern"},
                    {"es": "el hermano", "sv": "brodern"},
                    {"es": "la hermana", "sv": "systern"},
                    {"es": "el abuelo", "sv": "farfar/morfar"},
                    {"es": "la abuela", "sv": "farmor/mormor"},
                    {"es": "el t√≠o", "sv": "farbror/morbror"},
                    {"es": "la t√≠a", "sv": "faster/moster"},
                    {"es": "el primo", "sv": "kusinen (man)"},
                    {"es": "la prima", "sv": "kusinen (kvinna)"},
                    {"es": "el marido", "sv": "maken"},
                    {"es": "la mujer", "sv": "hustrun"},
                    {"es": "el novio", "sv": "pojkv√§nnen"},
                    {"es": "la novia", "sv": "flickv√§nnen"}
                ]
            },
            "colores": {
                "name": "F√§rger",
                "icon": "üé®",
                "color": "#2ecc71",
                "items": [
                    {"es": "negro", "sv": "svart"},
                    {"es": "blanco", "sv": "vit"},
                    {"es": "gris", "sv": "gr√•"},
                    {"es": "rojo", "sv": "r√∂d"},
                    {"es": "azul", "sv": "bl√•"},
                    {"es": "verde", "sv": "gr√∂n"},
                    {"es": "amarillo", "sv": "gul"},
                    {"es": "naranja", "sv": "orange"},
                    {"es": "rosa", "sv": "rosa"},
                    {"es": "marr√≥n", "sv": "brun"},
                    {"es": "morado", "sv": "lila"}
                ]
            },
            "emociones": {
                "name": "K√§nslor",
                "icon": "üòä",
                "color": "#f1c40f",
                "items": [
                    {"es": "Estoy contento/a", "sv": "Jag √§r glad"},
                    {"es": "Estoy triste", "sv": "Jag √§r ledsen"},
                    {"es": "Estoy enfadado/a", "sv": "Jag √§r arg"},
                    {"es": "Estoy cansado/a", "sv": "Jag √§r tr√∂tt"},
                    {"es": "Estoy enfermo/a", "sv": "Jag √§r sjuk"},
                    {"es": "Estoy bien", "sv": "Jag m√•r bra"},
                    {"es": "Estoy mal", "sv": "Jag m√•r d√•ligt"}
                ]
            },
            "dias_semana": {
                "name": "Veckodagar",
                "icon": "üìÖ",
                "color": "#1abc9c",
                "items": [
                    {"es": "lunes", "sv": "m√•ndag"},
                    {"es": "martes", "sv": "tisdag"},
                    {"es": "mi√©rcoles", "sv": "onsdag"},
                    {"es": "jueves", "sv": "torsdag"},
                    {"es": "viernes", "sv": "fredag"},
                    {"es": "s√°bado", "sv": "l√∂rdag"},
                    {"es": "domingo", "sv": "s√∂ndag"}
                ]
            },
            "presentacion": {
                "name": "Presentera dig",
                "icon": "üó£Ô∏è",
                "color": "#e67e22",
                "items": [
                    {"es": "¬øC√≥mo te llamas?", "sv": "Vad heter du?"},
                    {"es": "Me llamo...", "sv": "Jag heter..."},
                    {"es": "¬øDe d√≥nde eres?", "sv": "Var kommer du ifr√•n?"},
                    {"es": "Soy de Suecia", "sv": "Jag √§r fr√•n Sverige"},
                    {"es": "¬øCu√°ntos a√±os tienes?", "sv": "Hur gammal √§r du?"},
                    {"es": "Tengo ... a√±os", "sv": "Jag √§r ... √•r"},
                    {"es": "¬øD√≥nde vives?", "sv": "Var bor du?"},
                    {"es": "Vivo en...", "sv": "Jag bor i..."},
                    {"es": "¬øA qu√© te dedicas?", "sv": "Vad jobbar du med?"},
                    {"es": "Soy estudiante", "sv": "Jag √§r student"}
                ]
            },
            "verbos": {
                "name": "Verb (yo-form)",
                "icon": "üìù",
                "color": "#8e44ad",
                "items": [
                    {"es": "soy", "sv": "jag √§r (permanent)"},
                    {"es": "estoy", "sv": "jag √§r (tillf√§lligt)"},
                    {"es": "tengo", "sv": "jag har"},
                    {"es": "vivo", "sv": "jag bor"},
                    {"es": "trabajo", "sv": "jag arbetar"},
                    {"es": "hablo", "sv": "jag pratar"},
                    {"es": "me llamo", "sv": "jag heter"},
                    {"es": "quiero", "sv": "jag vill"},
                    {"es": "necesito", "sv": "jag beh√∂ver"},
                    {"es": "me gusta", "sv": "jag gillar"}
                ]
            },
            "paises": {
                "name": "L√§nder",
                "icon": "üåç",
                "color": "#16a085",
                "items": [
                    {"es": "Espa√±a", "sv": "Spanien"},
                    {"es": "Suecia", "sv": "Sverige"},
                    {"es": "Francia", "sv": "Frankrike"},
                    {"es": "Alemania", "sv": "Tyskland"},
                    {"es": "Italia", "sv": "Italien"},
                    {"es": "M√©xico", "sv": "Mexiko"},
                    {"es": "Argentina", "sv": "Argentina"},
                    {"es": "Estados Unidos", "sv": "USA"}
                ]
            },
            "en_la_tienda": {
                "name": "I butiken",
                "icon": "üõí",
                "color": "#e91e63",
                "items": [
                    {"es": "¬øCu√°nto cuesta?", "sv": "Hur mycket kostar det?"},
                    {"es": "¬øTiene esto en otra talla?", "sv": "Har ni denna i en annan storlek?"},
                    {"es": "¬øPuedo prob√°rmelo?", "sv": "Kan jag prova den?"},
                    {"es": "Me lo llevo", "sv": "Jag tar den"},
                    {"es": "¬øAceptan tarjeta?", "sv": "Tar ni kort?"},
                    {"es": "Solo estoy mirando", "sv": "Jag tittar bara"},
                    {"es": "Es demasiado caro", "sv": "Det √§r f√∂r dyrt"},
                    {"es": "Me queda bien", "sv": "Den passar mig"}
                ]
            },
            "en_el_taxi": {
                "name": "I taxin",
                "icon": "üöï",
                "color": "#ffc107",
                "items": [
                    {"es": "¬øEst√° libre?", "sv": "√Ñr du ledig?"},
                    {"es": "Al aeropuerto, por favor", "sv": "Till flygplatsen, tack"},
                    {"es": "Pare aqu√≠, por favor", "sv": "Stanna h√§r, tack"},
                    {"es": "¬øCu√°nto le debo?", "sv": "Hur mycket √§r jag skyldig?"},
                    {"es": "Qu√©dese con el cambio", "sv": "Beh√•ll v√§xeln"},
                    {"es": "Necesito un recibo", "sv": "Jag beh√∂ver ett kvitto"}
                ]
            },
            "en_el_restaurante": {
                "name": "P√• restaurang",
                "icon": "üçΩÔ∏è",
                "color": "#ff5722",
                "items": [
                    {"es": "Una mesa para dos, por favor", "sv": "Ett bord f√∂r tv√•, tack"},
                    {"es": "¬øQu√© me recomienda?", "sv": "Vad rekommenderar du?"},
                    {"es": "La cuenta, por favor", "sv": "Notan, tack"},
                    {"es": "Soy vegetariano/a", "sv": "Jag √§r vegetarian"},
                    {"es": "Est√° delicioso", "sv": "Det √§r j√§ttegott"},
                    {"es": "M√°s agua, por favor", "sv": "Mer vatten, tack"}
                ]
            },
            "en_el_bar": {
                "name": "P√• bar/klubb",
                "icon": "üç∫",
                "color": "#673ab7",
                "items": [
                    {"es": "Una cerveza, por favor", "sv": "En √∂l, tack"},
                    {"es": "Dos copas de vino", "sv": "Tv√• glas vin"},
                    {"es": "¬øQuieres tomar algo?", "sv": "Vill du ha n√•got att dricka?"},
                    {"es": "Yo invito", "sv": "Jag bjuder"},
                    {"es": "¬øQuieres bailar?", "sv": "Vill du dansa?"},
                    {"es": "Me lo he pasado muy bien", "sv": "Jag har haft det j√§ttekul"}
                ]
            },
            "en_el_hotel": {
                "name": "P√• hotellet",
                "icon": "üè®",
                "color": "#00bcd4",
                "items": [
                    {"es": "Tengo una reserva", "sv": "Jag har en bokning"},
                    {"es": "Quiero hacer el check-in", "sv": "Jag vill checka in"},
                    {"es": "¬øA qu√© hora es el check-out?", "sv": "N√§r √§r utcheckning?"},
                    {"es": "¬øEst√° incluido el desayuno?", "sv": "√Ñr frukost inkluderad?"},
                    {"es": "¬øCu√°l es la contrase√±a del wifi?", "sv": "Vad √§r wifi-l√∂senordet?"},
                    {"es": "¬øPueden llamarme un taxi?", "sv": "Kan ni ringa en taxi?"}
                ]
            },
            "direcciones": {
                "name": "Fr√•ga om v√§gen",
                "icon": "üó∫Ô∏è",
                "color": "#4caf50",
                "items": [
                    {"es": "¬øD√≥nde est√°...?", "sv": "Var ligger...?"},
                    {"es": "¬øC√≥mo llego a...?", "sv": "Hur kommer jag till...?"},
                    {"es": "¬øEst√° lejos?", "sv": "√Ñr det l√•ngt?"},
                    {"es": "Todo recto", "sv": "Rakt fram"},
                    {"es": "Gire a la derecha", "sv": "Sv√§ng h√∂ger"},
                    {"es": "Gire a la izquierda", "sv": "Sv√§ng v√§nster"},
                    {"es": "Estoy perdido/a", "sv": "Jag har g√•tt vilse"}
                ]
            },
            "emergencias": {
                "name": "N√∂dsituationer",
                "icon": "üö®",
                "color": "#f44336",
                "items": [
                    {"es": "¬°Ayuda!", "sv": "Hj√§lp!"},
                    {"es": "¬°Llame a la polic√≠a!", "sv": "Ring polisen!"},
                    {"es": "Necesito un m√©dico", "sv": "Jag beh√∂ver en l√§kare"},
                    {"es": "Me han robado", "sv": "Jag har blivit bestulen"},
                    {"es": "He perdido mi pasaporte", "sv": "Jag har tappat mitt pass"},
                    {"es": "No me siento bien", "sv": "Jag m√•r inte bra"}
                ]
            }
        };

        // App State
        let allCards = [];
        let questions = [];
        let currentIndex = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let currentMode = 'es_to_sv';
        let currentCategory = null;
        let hasAnswered = false;
        const QUIZ_LENGTH = 15;

        // DOM Elements
        const categoryView = document.getElementById('categoryView');
        const quizView = document.getElementById('quizView');
        const categoriesList = document.getElementById('categoriesList');
        const questionWord = document.getElementById('questionWord');
        const questionLabel = document.getElementById('questionLabel');
        const questionCategory = document.getElementById('questionCategory');
        const optionsGrid = document.getElementById('optionsGrid');
        const feedback = document.getElementById('feedback');
        const nextBtn = document.getElementById('nextBtn');
        const resultsScreen = document.getElementById('resultsScreen');

        // Build all cards array
        Object.keys(flashcardData).forEach(key => {
            flashcardData[key].items.forEach(item => {
                allCards.push({...item, category: flashcardData[key].name, categoryKey: key});
            });
        });

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Category groups definition
        const categoryGroups = {
            "situationer": {
                name: "Situationer",
                icon: "üéØ",
                categories: ["en_la_tienda", "en_el_taxi", "en_el_restaurante", "en_el_bar", "en_el_hotel", "direcciones", "emergencias"]
            },
            "grundlaggande": {
                name: "Grundl√§ggande",
                icon: "üìö",
                categories: ["saludos", "numeros", "interrogativos", "familia", "colores", "emociones", "dias_semana", "presentacion", "verbos", "paises"]
            }
        };

        // Create category item HTML
        function createCategoryItem(key, categoryProgress) {
            const cat = flashcardData[key];
            const progress = categoryProgress[key] || 0;
            const circumference = 2 * Math.PI * 18;
            const offset = circumference - (progress / 100) * circumference;

            const item = document.createElement('div');
            item.className = 'category-item';
            item.dataset.category = key;
            item.innerHTML = `
                <div class="category-icon" style="background: ${cat.color}20; color: ${cat.color};">
                    ${cat.icon}
                </div>
                <div class="category-info">
                    <div class="category-name">${cat.name}</div>
                    <div class="category-count">${cat.items.length} fr√•gor</div>
                </div>
                <div class="progress-circle">
                    <svg width="45" height="45">
                        <circle class="bg" cx="22.5" cy="22.5" r="18"></circle>
                        <circle class="progress" cx="22.5" cy="22.5" r="18"
                            stroke-dasharray="${circumference}"
                            stroke-dashoffset="${offset}"
                            style="stroke: ${cat.color}"></circle>
                    </svg>
                </div>
            `;
            item.addEventListener('click', () => startQuiz(key));
            return item;
        }

        function initCategories() {
            const saved = JSON.parse(localStorage.getItem('spanishQuiz') || '{}');
            const categoryProgress = saved.categoryProgress || {};
            const expandedGroups = JSON.parse(localStorage.getItem('spanishQuizExpanded') || '["situationer"]');

            // Create category groups
            Object.keys(categoryGroups).forEach(groupKey => {
                const group = categoryGroups[groupKey];
                const totalQuestions = group.categories.reduce((sum, catKey) => sum + flashcardData[catKey].items.length, 0);

                const groupEl = document.createElement('div');
                groupEl.className = 'category-group' + (expandedGroups.includes(groupKey) ? ' expanded' : '');
                groupEl.dataset.group = groupKey;

                // Group header
                const header = document.createElement('div');
                header.className = 'category-group-header';
                header.innerHTML = `
                    <div class="category-group-title">
                        <span class="group-icon">${group.icon}</span>
                        ${group.name}
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span class="category-group-count">${group.categories.length} kategorier ¬∑ ${totalQuestions} fr√•gor</span>
                        <span class="category-group-arrow">‚ñº</span>
                    </div>
                `;
                header.addEventListener('click', () => toggleGroup(groupKey));

                // Group items container
                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'category-group-items';

                // Add categories to group
                group.categories.forEach(catKey => {
                    if (flashcardData[catKey]) {
                        itemsContainer.appendChild(createCategoryItem(catKey, categoryProgress));
                    }
                });

                groupEl.appendChild(header);
                groupEl.appendChild(itemsContainer);
                categoriesList.appendChild(groupEl);
            });

            updateOverviewStats();
        }

        // Toggle group expanded/collapsed
        function toggleGroup(groupKey) {
            const groupEl = document.querySelector(`.category-group[data-group="${groupKey}"]`);
            groupEl.classList.toggle('expanded');

            // Save expanded state
            const expandedGroups = [];
            document.querySelectorAll('.category-group.expanded').forEach(g => {
                expandedGroups.push(g.dataset.group);
            });
            localStorage.setItem('spanishQuizExpanded', JSON.stringify(expandedGroups));
        }

        function updateOverviewStats() {
            const saved = JSON.parse(localStorage.getItem('spanishQuiz') || '{}');
            document.getElementById('totalSessions').textContent = saved.sessions || 0;
            document.getElementById('totalCorrect').textContent = saved.totalCorrect || 0;
            const total = (saved.totalCorrect || 0) + (saved.totalWrong || 0);
            const acc = total > 0 ? Math.round((saved.totalCorrect / total) * 100) : 0;
            document.getElementById('accuracy').textContent = `${acc}%`;
        }

        function startQuiz(category) {
            currentCategory = category;
            let cards = category === 'all'
                ? [...allCards]
                : flashcardData[category].items.map(item => ({
                    ...item,
                    category: flashcardData[category].name,
                    categoryKey: category
                }));

            shuffle(cards);
            questions = cards.slice(0, Math.min(QUIZ_LENGTH, cards.length));

            currentIndex = 0;
            correctCount = 0;
            wrongCount = 0;

            const title = category === 'all' ? 'Alla kategorier' : flashcardData[category].name;
            document.getElementById('quizTitle').textContent = title;

            categoryView.classList.add('hidden');
            quizView.classList.add('active');
            resultsScreen.classList.remove('show');

            displayQuestion();
        }

        function getWrongAnswers(correctCard, isEsToSv) {
            const correctAnswer = isEsToSv ? correctCard.sv : correctCard.es;
            const sameCategory = allCards.filter(c =>
                c.categoryKey === correctCard.categoryKey &&
                (isEsToSv ? c.sv : c.es) !== correctAnswer
            );

            let pool = sameCategory.length >= 3 ? sameCategory : allCards.filter(c =>
                (isEsToSv ? c.sv : c.es) !== correctAnswer
            );

            shuffle(pool);
            return pool.slice(0, 3).map(c => isEsToSv ? c.sv : c.es);
        }

        function displayQuestion() {
            if (currentIndex >= questions.length) {
                showResults();
                return;
            }

            hasAnswered = false;
            const card = questions[currentIndex];

            const isEsToSv = currentMode === 'es_to_sv' ||
                            (currentMode === 'mixed' && Math.random() > 0.5);

            const question = isEsToSv ? card.es : card.sv;
            const correctAnswer = isEsToSv ? card.sv : card.es;

            questionWord.textContent = question;
            questionLabel.textContent = isEsToSv ? '√ñvers√§tt till svenska' : '√ñvers√§tt till spanska';
            questionCategory.textContent = card.category;

            const wrongAnswers = getWrongAnswers(card, isEsToSv);
            const options = shuffle([correctAnswer, ...wrongAnswers]);

            const btns = optionsGrid.querySelectorAll('.option-btn');
            btns.forEach((btn, i) => {
                btn.textContent = options[i];
                btn.className = 'option-btn';
                btn.disabled = false;
                btn.dataset.correct = options[i] === correctAnswer ? 'true' : 'false';
                btn.onclick = () => handleAnswer(i);
            });

            feedback.classList.remove('show', 'correct', 'wrong');
            nextBtn.classList.remove('show');
            updateProgress();
        }

        function handleAnswer(index) {
            if (hasAnswered) return;
            hasAnswered = true;

            const btns = optionsGrid.querySelectorAll('.option-btn');
            const selectedBtn = btns[index];
            const isCorrect = selectedBtn.dataset.correct === 'true';

            btns.forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.correct === 'true') {
                    btn.classList.add('correct');
                }
            });

            if (isCorrect) {
                correctCount++;
                feedback.textContent = 'R√§tt!';
                feedback.className = 'feedback show correct';
            } else {
                wrongCount++;
                selectedBtn.classList.add('wrong');
                feedback.textContent = 'Fel! R√§tt svar √§r markerat.';
                feedback.className = 'feedback show wrong';
            }

            nextBtn.classList.add('show');
            updateStats();
        }

        function nextQuestion() {
            currentIndex++;
            displayQuestion();
        }

        function updateProgress() {
            const progress = (currentIndex / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('quizProgressText').textContent = `${currentIndex + 1}/${questions.length}`;
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            const total = correctCount + wrongCount;
            const percent = total > 0 ? Math.round((correctCount / total) * 100) : 0;
            document.getElementById('scorePercent').textContent = `${percent}%`;
        }

        function showResults() {
            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalWrong').textContent = wrongCount;
            const total = correctCount + wrongCount;
            const percent = total > 0 ? Math.round((correctCount / total) * 100) : 0;
            document.getElementById('finalPercent').textContent = `${percent}%`;

            resultsScreen.classList.add('show');
            saveProgress(percent);
        }

        function saveProgress(percent) {
            const saved = JSON.parse(localStorage.getItem('spanishQuiz') || '{}');
            saved.totalCorrect = (saved.totalCorrect || 0) + correctCount;
            saved.totalWrong = (saved.totalWrong || 0) + wrongCount;
            saved.sessions = (saved.sessions || 0) + 1;
            saved.lastSession = new Date().toISOString();

            if (currentCategory && currentCategory !== 'all') {
                saved.categoryProgress = saved.categoryProgress || {};
                const oldProgress = saved.categoryProgress[currentCategory] || 0;
                saved.categoryProgress[currentCategory] = Math.max(oldProgress, percent);
            }

            localStorage.setItem('spanishQuiz', JSON.stringify(saved));
        }

        function backToCategories() {
            quizView.classList.remove('active');
            categoryView.classList.remove('hidden');
            resultsScreen.classList.remove('show');
            updateOverviewStats();
            categoriesList.innerHTML = '';
            initCategories();
        }

        // Event Listeners
        document.getElementById('practiceAllBtn').addEventListener('click', () => startQuiz('all'));
        document.getElementById('quickQuizBtn').addEventListener('click', () => startQuiz('all'));
        document.getElementById('backToCategories').addEventListener('click', backToCategories);
        document.getElementById('backFromResults').addEventListener('click', backToCategories);
        document.getElementById('restartBtn').addEventListener('click', () => {
            resultsScreen.classList.remove('show');
            startQuiz(currentCategory);
        });
        nextBtn.addEventListener('click', nextQuestion);

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMode = btn.dataset.mode;
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (!quizView.classList.contains('active') || resultsScreen.classList.contains('show')) return;

            if (e.key >= '1' && e.key <= '4' && !hasAnswered) {
                const index = parseInt(e.key) - 1;
                handleAnswer(index);
            } else if (e.key === 'Enter' && hasAnswered) {
                nextQuestion();
            }
        });

        // Initialize
        initCategories();
    </script>
</body>
</html>
